<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />

    <title>Hello, world!</title>
  </head>
  <body>
    <!-- bootstrap- dropdown-toggle -->
    <div class="btn-group">
      <button
        type="button"
        class="btn btn-primary dropdown-toggle"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        Year
      </button>
      <ul class="dropdown-menu" id="test"></ul>
    </div>

    <div class="form-check form-switch">
      <input
        class="form-check-input success-switch"
        type="checkbox"
        id="flexSwitchCheckDefault"
      />
      <label class="form-check-label" for="flexSwitchCheckDefault"
        >Successfull Launch</label
      >
    </div>

    <div class="container"></div>

    <!-- Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>

    <script>
      let yearFilter = 0;
      var globalArray;
      var users;
      let flag = 0;
      // get clicked option value
      //         function getEventTarget(e) {
      //     e = e || window.event;
      //     return e.target || e.srcElement;
      // }

      // var ul = document.getElementById('test');
      // ul.onclick = function(event) {
      //     var target = getEventTarget(event);
      //     alert(target.innerHTML);
      // };
      // radio check logic
      let successSwitch = document.querySelector(".success-switch");

      successSwitch.addEventListener("change", () => {
        renderUsers();
      });

      async function getUsers() {
        let url = "https://api.spacexdata.com/v3/launches?limit=100";
        try {
          let res = await fetch(url);
          globalArray = await res.json();
        } catch (error) {
          console.log(error);
        }

        if (successSwitch.checked == true) {
          url =
            "https://api.spacexdata.com/v3/launches?limit=100&launch_success=true";
        }
        if (flag == 1) {
          url = `https://api.spaceXdata.com/v3/launches?limit=100&launch_year=${year}`;
        }

        try {
          let res = await fetch(url);
          return await res.json();
        } catch (error) {
          console.log(error);
        }
      }
      function selectThis(event) {
        console.log(event.target.innerHTML);
        flag = 1;
        year = event.target.innerHTML;
        users = users.filter(function (user) {
          return user.launch_year == event.target.innerHTML;
        });
        renderUsers();
      }

      async function renderUsers() {
        users = await getUsers();

        // console.log(users);
        let html = "";
        users.forEach((user) => {
          let htmlSegment = `<div class="user" style="margin:50px 20px">
            <ul>
                             <p>Flight Number:${user.flight_number}</p> 
                         <li>    <p>Mission Name:${user.mission_name}</p></li>
                             <li>  <p>ðŸš€ Launch Year:${user.launch_year}</p></li>
                         </ul>
                        </div>`;

          html += htmlSegment;
        });

        let yearChoice = "";
        // var uniqueArray = [...new Set(globalArray)];
        globalArray = [...globalArray];
        var uniqueArray = [
          ...new Set(globalArray.map((event) => event.launch_year)),
        ];
        console.log(uniqueArray);
        uniqueArray.forEach((ele) => {
          yearChoice += `<li onclick="selectThis(event)"><a class="dropdown-item" href="#">${ele}</a></li>`;
        });

        let optionList = document.querySelector(".dropdown-menu");
        optionList.innerHTML = yearChoice;
        let container = document.querySelector(".container");
        container.innerHTML = html;
      }

      renderUsers();
    </script>
  </body>
</html>
