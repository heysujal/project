<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <!-- Bootstrap Bundle with Popper -->

    <title>Launches by SpaceX</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
@media only screen and (max-width: 600px) {
  .custom-filters{
        flex-direction: column;
      }
}
      
    </style>
  </head>

  <body>
    <!-- bootstrap- dropdown-toggle -->
   
    <div class="custom-filters" style="display: flex;flex-direction: column; justify-content: center;padding:30px 30px;width:100%">
      <h1>Filters</h1>
      <div class="btn-group" style="padding: 30px 0px;width:30px">
        <button
          type="button"
          class="btn btn-primary dropdown-toggle selected-year-btn"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Year
        </button>
        <ul class="dropdown-menu" id="test"></ul>
      </div>

      <!-- switch -->
      <div class="form-check form-switch">
        <input class="form-check-input success-launch-switch" type="checkbox" />
        <label class="form-check-label" for="flexSwitchCheckDefault"
          >Successfull Launch</label
        >
      </div>
      <div class="form-check form-switch">
        <input class="form-check-input success-land-switch" type="checkbox" />
        <label class="form-check-label" for="flexSwitchCheckDefault"
          >Successfull Land</label
        >
      </div>
    </div>
 
    <div class="container cards-content"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>
    <script>
      var globalArray;
      var users;

      var yearChoice = ``;
      var yearList = [];
      var successLaunchSwitch = document.querySelector(
        ".success-launch-switch"
      );
      var uniqueArray;
      var selectedYear = document.querySelector(".selected-year-btn");
      var successLandSwitch = document.querySelector(".success-land-switch");

      var landSuccess = sessionStorage.getItem("landSuccess");
      var launchSuccess = sessionStorage.getItem("launchSuccess");
      var year = sessionStorage.getItem("year");

      // setting onload Values

      landSuccess == null && sessionStorage.setItem("landSuccess", "");
      launchSuccess == null && sessionStorage.setItem("launchSuccess", "");
      year == null && sessionStorage.setItem("year", "");
      landSuccess = sessionStorage.getItem("landSuccess");
      launchSuccess = sessionStorage.getItem("launchSuccess");
      year = sessionStorage.getItem("year");
      if (year != null) {
        if (sessionStorage.getItem("year") == "") {
          selectedYear.innerHTML = "All";
        } else {
          selectedYear.innerHTML = sessionStorage.getItem("year");
        }
      }
      if (sessionStorage.getItem("launchSuccess") == "true") {
        successLaunchSwitch.checked = true;
      }

      if (sessionStorage.getItem("landSuccess") == "true") {
        successLandSwitch.checked = true;
      }

      async function globalURL() {
        try {
          let res = await fetch(
            "https://api.spaceXdata.com/v3/launches?limit=100"
          );
          globalArray = await res.json();
          for (i = 0; i < globalArray.length; i++) {
            yearList.push(globalArray[i].launch_year);
          }
        } catch (error) {
          console.log(error);
        }
      }
      globalURL();

      var url = `https://api.spacexdata.com/v3/launches?limit=100&launch_success=${launchSuccess}&land_success=${landSuccess}&launch_year=${year}`;

      function updateURL() {
        url = `https://api.spacexdata.com/v3/launches?limit=100&launch_success=${sessionStorage.getItem(
          "launchSuccess"
        )}&land_success=${sessionStorage.getItem(
          "landSuccess"
        )}&launch_year=${sessionStorage.getItem("year")}`;

        console.log(url);
      }
      successLaunchSwitch.addEventListener("change", () => {
        if (successLaunchSwitch.checked == true) {
          launchSuccess = "true";
        } else {
          launchSuccess = "";
        }

        sessionStorage.setItem("launchSuccess", launchSuccess);
        updateURL();

        renderUsers();
      });
      successLandSwitch.addEventListener("change", () => {
        if (successLandSwitch.checked == true) {
          landSuccess = "true";
        } else {
          landSuccess = "";
        }
        sessionStorage.setItem("landSuccess", landSuccess);
        updateURL();

        renderUsers();
      });

      function selectThis(event) {
        if (event.target.innerHTML === "All") {
          year = "";
        } else {
          year = event.target.innerHTML;
        }

        selectedYear.innerHTML = event.target.innerHTML;
        sessionStorage.setItem("year", year);
        updateURL();

        renderUsers();
      }
      async function getUsers() {
        try {
          let res = await fetch(url);
          return await res.json();
        } catch (error) {
          console.log(error);
        }
      }
      async function renderUsers() {
        users = await getUsers();

        let html = "";
        users.forEach((user) => {
          let htmlSegment = `
                        
                      
 <div class="card user h-100" style="width: 18rem;border:1px solid black;margin:30px 0">
<a style="" target="_blank" href="${user.links.mission_patch}"><img class="card-img-top" src="${user.links.mission_patch_small}" alt="Card image cap"> </a>
  
 
  <ul class="list-group list-group-flush">
    <li class="list-group-item">Flight Number: ${user.flight_number} </li>
    <li class="list-group-item">Fligth Name: ${user.mission_name} </li>
    <li class="list-group-item">Rocket Name: ${user.rocket.rocket_name} </li>
    <li class="list-group-item">Rocket Type: ${user.rocket.rocket_type} </li>
    <li class="list-group-item">Rocket Type: ${user.rocket.second_stage.payloads[0].nationality} </li>
    <li class="list-group-item">ðŸš€ Launch Year: ${user.launch_year} </li>
    <li class="list-group-item">Details: ${user.details} </li>
     
     
  </ul>
   <div class="card-body">
    <a target="_blank" href="${user.links.article_link}" class="card-link">Article</a>
    <a target="_blank" href="${user.links.wikipedia}" class="card-link">Wikipedia</a>
    <a target="_blank" href="${user.links.video_link}" class="card-link">Video</a>
   
    
  </div>
</div>
         `;

          html += htmlSegment;
        });

        let cardsContent = document.querySelector(".cards-content");
        cardsContent.innerHTML =
          `<div style="display:flex;flex-wrap: wrap;justify-content:space-evenly;"> ` +
          html +
          `</div>`;
      }

      setTimeout(() => {
        uniqueArray = [...new Set(yearList.map((event) => event))];

        uniqueArray.forEach((ele) => {
          yearChoice += `<li onclick="selectThis(event)"><a class="dropdown-item" href="#">${ele}</a></li>`;
        });

        let optionList = document.querySelector(".dropdown-menu");
        optionList.innerHTML =
          `<li onclick="selectThis(event)"><a class="dropdown-item" href="#">All</a></li>` +
          yearChoice;
      }, 1000);

      renderUsers();
    </script>
  </body>
</html>
